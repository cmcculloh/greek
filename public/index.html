<link href="styles.css" rel="stylesheet" type="text/css">

<div id="overworld"></div>

<div id="mobs"></div>
<div id="steve"></div>

<input type="button" value="regenerate board" onclick="confirmRegenerate()" style="position: fixed; bottom: 15px; right: 15px;">
<div id="instructions">
	<input type="button" value="x" style="position: absolute; right: 0; top: 0;" onclick="hide()">
	<div style="padding: 15px;">Use W,A,S,D keys to move around the board.</div>

	<div>
	<select id="songChoice">
		<option value="POL-castle-rooms-short.m4a">Castle Rooms</option>
		<option value="POL-foggy-forest-short.m4a">Foggy Forest</option>
		<option value="POL-green-town-short.m4a">Green Town</option>
		<option value="POL-lost-hero-short.m4a">Lost Hero</option>
		<option value="POL-stable-boy-short.m4a">Stable Boy</option>
	</select>
	<script>
		const audioOptions = [
			{ value:"POL-castle-rooms-short.m4a", name: 'Castle Rooms' },
			{ value:"POL-foggy-forest-short.m4a", name: 'Foggy Forest' },
			{ value:"POL-green-town-short.m4a", name: 'Green Town' },
			{ value:"POL-lost-hero-short.m4a", name: 'Lost Hero' },
			{ value:"POL-stable-boy-short.m4a", name: 'Stable Boy' }
		];

		let play = localStorage.getItem( 'playSongs' ) !== undefined ? localStorage.getItem( 'playSongs' ) : true;
		const playSong = (file, audio = new Audio(`/music/POL-foggy-forest-short.m4a`)) => {
			if (!play) return;
			console.log('play song', file);

			audio.pause();
			audio = new Audio(`/music/${file}`);
			audio.play();

			let loops = 0;
			let listener = audio.addEventListener('ended', function() {
				console.log('looping');
				loops++;

				if (loops > 4) {
					audio.removeEventListener('ended', listener);
					playSong(audioOptions[Math.floor(Math.random() * audioOptions.length)].value);
				} else {
					audio.play();
				}
			}, false);

			return audio;
		}

		let audio = playSong('POL-foggy-forest-short.m4a');


		const stopMusic = () => {
			console.log('stahp');
			audio.pause();
			play = false;
			localStorage.setItem( 'playSongs', false );
		}
		document.querySelector('#stopMusic').addEventListener('click', stopMusic);

		document.querySelector('#songChoice').addEventListener('click', (e) => {
			localStorage.setItem( 'playSongs', true );
			play = true;
			audio = playSong(e.target.value, audio);
		});

	</script>
</div>
	<div>Background music by PlayOnLoop.com Licensed under Creative Commons by Attribution 4.0</div>
	<div style="padding: 15px;"><input type="checkbox" id="hardmode"/> Check this box to have to type the name of the letter instead.</div>
	<div style="padding: 15px;"><input type="checkbox" id="fogofwar"/> Fog of War.</div>
</div>
<div id="showInstructions" class="hide">
	<input type="button" value=">" style="position: absolute; right: 0; top: 0;" onclick="show()">
</div>
<script>
	const initInstructions = () => {
		localStorage.getItem( 'hideInstructions' ) ? hide() : show();
	}

	const hide = () => {
		document.querySelector('#instructions').classList.add('hide');
		document.querySelector('#showInstructions').classList.remove('hide');
		localStorage.setItem( 'hideInstructions', true );
	}

	const show = () => {
		document.querySelector('#instructions').classList.remove('hide');
		document.querySelector('#showInstructions').classList.add('hide');

		localStorage.setItem( 'hideInstructions', false );
	}
	initInstructions();
</script>
<div id="tools"></div>

<div id="overlay"></div>
<div id="battle"></div>
<div id="dungeon"></div>
<div id="quiz"></div>
<div id="damage"></div>
<div id="result"></div>
<div id="scoreBoard"></div>

<script src="./questions.js"></script>
<script src="./script.js"></script>